
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhD Waste Stream Selection MCDA - Dashboard</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['Lora', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#059669',   /* Emerald 600 */
                            secondary: '#0891b2', /* Cyan 600 */
                            dark: '#0f172a',      /* Slate 900 */
                            accent: '#f59e0b',    /* Amber 500 */
                            light: '#f0fdf4',     /* Emerald 50 */
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
             transform: translateY(-5px);
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
             border-color: #34d399;
        }
        
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #059669;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-emerald-200 relative">

<div id="root"></div>

<script type="text/babel">

    const { useState, useEffect, useMemo, useRef } = React;

    // --- WASTE STREAMS (Locked Set) ---
    const WASTES = [
        "Banana Pseudostem (Fibers)",
        "Wheat Straw",
        "Olive Pomace",
        "Grape Pomace",
        "Poultry Feather Waste"
    ];

    // --- WASTE METADATA ---
    const WASTE_METADATA = {
        "Banana Pseudostem (Fibers)": {
            quantity: "329,246 t/y",
            category: "Plant-based",
            fiberType: "Long cellulosic fibers",
            seasonality: "Continuous",
            confidence: "High",
            link: "#"
        },
        "Wheat Straw": {
            quantity: "120,000 t/y",
            category: "Plant-based",
            fiberType: "Short cellulosic fibers",
            seasonality: "Seasonal (harvest)",
            confidence: "High",
            link: "#"
        },
        "Olive Pomace": {
            quantity: "79,000 t/y",
            category: "Plant-based",
            fiberType: "Short fibers / ash potential",
            seasonality: "Seasonal (processing)",
            confidence: "High",
            link: "#"
        },
        "Grape Pomace": {
            quantity: "14,037 t/y",
            category: "Plant-based",
            fiberType: "Short fibers",
            seasonality: "Seasonal (harvest)",
            confidence: "Moderate",
            link: "#"
        },
        "Poultry Feather Waste": {
            quantity: "7,302 t/y",
            category: "Animal-based",
            fiberType: "Keratin protein fibers",
            seasonality: "Continuous",
            confidence: "Moderate",
            link: "#"
        }
    };

    // --- CRITERIA DATA (All scores locked, weights adjustable) ---
    const INITIAL_CRITERIA = [
        {
            id: 'c1',
            name: 'C1: Recoverable Supply Scale',
            weight: 20,
            description: 'National recoverable waste quantity in Lebanon (tonnes/year). Measures feedstock availability for research scaling and reproducibility.',
            rationale: 'Supply matters for research practicality (sampling, repeat experiments) and impact story. Not overweighted to avoid bias toward largest wastes.',
            scoringLogic: 'Score 5: >250k t/y | Score 4: 100k-250k | Score 3: 50k-100k | Score 2: 10k-50k | Score 1: <10k',
            indicator: 'National recoverable waste quantity (t/y)',
            source: 'National waste mapping dataset',
            scores: {
                "Banana Pseudostem (Fibers)": 5,
                "Wheat Straw": 4,
                "Olive Pomace": 3,
                "Grape Pomace": 2,
                "Poultry Feather Waste": 1
            }
        },
        {
            id: 'c2',
            name: 'C2: Handling & Pre-treatment Burden',
            weight: 15,
            description: 'Difficulty, energy intensity, and complexity of converting raw waste into stable, usable feedstock for construction research.',
            rationale: 'Affects both material feasibility (energy footprint, cost, regulation) and research practicality (fieldwork complexity, reproducibility).',
            scoringLogic: 'Score 5: Low burden (simple drying) | Score 4: Moderate-low (drying+grinding) | Score 3: Moderate (wet, odor) | Score 2: High (bio-safety) | Score 1: Very high (hazardous)',
            indicator: 'Type and intensity of pre-treatment required',
            source: 'Literature review of handling practices',
            scores: {
                "Wheat Straw": 5,
                "Banana Pseudostem (Fibers)": 4,
                "Olive Pomace": 3,
                "Grape Pomace": 3,
                "Poultry Feather Waste": 2
            }
        },
        {
            id: 'c3',
            name: 'C3: Environmental Urgency',
            weight: 20,
            description: 'Strength of peer-reviewed evidence that unmanaged disposal causes environmental harm (water/air pollution, GHG emissions).',
            rationale: 'Environmental urgency is a core justification for waste valorisation, aligning with sustainability objectives and funder priorities.',
            scoringLogic: 'Score 5: Severe pollution + unmanaged | Score 4: High burden | Score 3: Moderate burden | Score 2: Limited burden | Score 1: Low urgency',
            indicator: 'Documented environmental harm from unmanaged disposal',
            source: 'Peer-reviewed literature, FAO/UNEP reports',
            scores: {
                "Olive Pomace": 4,
                "Banana Pseudostem (Fibers)": 4,
                "Wheat Straw": 3,
                "Grape Pomace": 3,
                "Poultry Feather Waste": 3
            }
        },
        {
            id: 'c4',
            name: 'C4: Construction Evidence',
            weight: 25,
            description: 'Number and quality of peer-reviewed studies demonstrating functional use in civil engineering materials with performance benefits.',
            rationale: 'Highest weight (25%) because technical feasibility governs publishable material science and PhD viability.',
            scoringLogic: 'Score 5: Excellent (multiple studies) | Score 4: Good (strong evidence) | Score 3: Moderate (sparse/exploratory) | Score 2: Weak (speculative) | Score 1: None',
            indicator: 'Peer-reviewed construction materials research',
            source: 'Literature review of material performance studies',
            scores: {
                "Banana Pseudostem (Fibers)": 4,
                "Wheat Straw": 4,
                "Olive Pomace": 4,
                "Poultry Feather Waste": 3,
                "Grape Pomace": 3
            }
        },
        {
            id: 'c5',
            name: 'C5: Research Novelty',
            weight: 10,
            description: 'Saturation of peer-reviewed research on construction applications. High scores indicate strong opportunity for PhD-level contribution.',
            rationale: 'Novelty is essential for PhD impact, but modest weight (10%) to avoid overriding technical/environmental considerations.',
            scoringLogic: 'Score 5: Very high novelty (pioneer field) | Score 4: High novelty (clear gaps) | Score 3: Moderate novelty | Score 2: Low novelty (saturated) | Score 1: No novelty',
            indicator: 'Research gap analysis',
            source: 'Literature review and publication analysis',
            scores: {
                "Grape Pomace": 5,
                "Banana Pseudostem (Fibers)": 4,
                "Poultry Feather Waste": 4,
                "Olive Pomace": 3,
                "Wheat Straw": 2
            }
        },
        {
            id: 'c6',
            name: 'C6: Global Scalability',
            weight: 10,
            description: 'Global production scale of corresponding crop/sector as proxy for international transferability and replication potential.',
            rationale: 'Captures global impact potential beyond Lebanon, especially important for poultry feathers. Separate from local supply (C1).',
            scoringLogic: 'Score 5: ‚â•500M t/y | Score 4: 100M-500M | Score 3: 10M-100M | Score 2: 1M-10M | Score 1: <1M',
            indicator: 'Global production (World, 2023, FAOSTAT)',
            source: 'FAOSTAT QCL database',
            scores: {
                "Wheat Straw": 5,
                "Banana Pseudostem (Fibers)": 4,
                "Poultry Feather Waste": 4,
                "Grape Pomace": 3,
                "Olive Pomace": 3
            }
        }
    ];

    const COLORS = {
        "Banana Pseudostem (Fibers)": '#f59e0b',  // Amber
        "Wheat Straw": '#eab308',                  // Yellow
        "Olive Pomace": '#059669',                 // Emerald
        "Grape Pomace": '#8b5cf6',                 // Violet
        "Poultry Feather Waste": '#0891b2'         // Cyan
    };

    const App = () => {
        // --- State ---
        const [criteria, setCriteria] = useState(INITIAL_CRITERIA);
        const [activeTab, setActiveTab] = useState('overview');
        const [selectedWaste, setSelectedWaste] = useState(null);
        const [enforceVariability, setEnforceVariability] = useState(false);

        // --- Calculations ---
        const results = useMemo(() => {
            const data = WASTES.map(waste => {
                let totalScore = 0;
                const contributions = {};
                const rawScores = {};

                criteria.forEach(crit => {
                    const score = crit.scores[waste];
                    rawScores[crit.id] = score;
                    const contribution = score * (crit.weight / 100);
                    totalScore += contribution;
                    contributions[crit.id] = contribution;
                });

                return {
                    name: waste,
                    score: totalScore,
                    rawScores,
                    contributions,
                    category: WASTE_METADATA[waste].category
                };
            });

            // Sort by score
            let sorted = data.sort((a, b) => b.score - a.score);

            // Apply variability toggle logic
            if (enforceVariability) {
                const top3 = sorted.slice(0, 3);
                const allPlantBased = top3.every(w => w.category === "Plant-based");
                
                if (allPlantBased) {
                    // Find poultry feathers
                    const poultryIndex = sorted.findIndex(w => w.name === "Poultry Feather Waste");
                    if (poultryIndex > 2) {
                        // Remove poultry from current position
                        const poultry = sorted.splice(poultryIndex, 1)[0];
                        // Insert at position 3 (index 2)
                        sorted.splice(2, 0, poultry);
                        // Mark it as variability-adjusted
                        poultry.variabilityAdjusted = true;
                    }
                }
            }

            return sorted;
        }, [criteria, enforceVariability]);

        const winner = results[0];
        const runnerUp = results[1];
        const thirdPlace = results[2];
        
        const activeWaste = selectedWaste ? results.find(r => r.name === selectedWaste) : winner;

        // --- Handlers ---
        const handleWeightChange = (id, newWeight) => {
            setCriteria(prev => prev.map(c => c.id === id ? { ...c, weight: parseFloat(newWeight) } : c));
        };

        const resetData = () => {
            setCriteria(INITIAL_CRITERIA);
            setEnforceVariability(false);
        };

        const applyPreset = (preset) => {
            let newWeights = {};
            
            switch(preset) {
                case 'equal':
                    newWeights = { c1: 16.67, c2: 16.67, c3: 16.67, c4: 16.67, c5: 16.66, c6: 16.66 };
                    break;
                case 'supply':
                    newWeights = { c1: 40, c2: 10, c3: 15, c4: 20, c5: 5, c6: 10 };
                    break;
                case 'environmental':
                    newWeights = { c1: 15, c2: 10, c3: 40, c4: 20, c5: 5, c6: 10 };
                    break;
                case 'technical':
                    newWeights = { c1: 15, c2: 15, c3: 10, c4: 45, c5: 10, c6: 5 };
                    break;
                default:
                    return;
            }
            
            setCriteria(prev => prev.map(c => ({ ...c, weight: newWeights[c.id] })));
        };

        // --- Components ---
        const TabButton = ({ tab, label, icon }) => (
            <button 
                onClick={() => setActiveTab(tab)}
                className={`flex items-center gap-2 px-4 py-2 rounded-full transition whitespace-nowrap text-sm font-semibold border
                    ${activeTab === tab 
                        ? 'text-brand-primary bg-emerald-50 border-emerald-200 shadow-sm' 
                        : 'text-slate-600 hover:text-brand-primary hover:bg-slate-50 border-transparent'}`}
            >
                <span className="text-base">{icon}</span>
                {label}
            </button>
        );

        return (
            <div className="flex flex-col min-h-screen">
                
                {/* HERO HEADER */}
                <header className="relative bg-gradient-to-br from-emerald-700 via-teal-600 to-cyan-800 text-white pt-16 pb-32 px-6 overflow-hidden shadow-2xl">
                    <div className="absolute inset-0 opacity-10" style={{backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '30px 30px'}}></div>
                    <div className="absolute top-0 right-0 w-96 h-96 bg-emerald-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"></div>
                    <div className="absolute bottom-0 left-0 w-96 h-96 bg-cyan-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float" style={{animationDelay: '2s'}}></div>
                    
                    <div className="relative container mx-auto max-w-7xl text-center z-10 animate-fade-in-up">
                        <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-xs font-semibold tracking-wide mb-6 uppercase shadow-sm">
                            <span className="w-2 h-2 bg-emerald-300 rounded-full animate-pulse shadow-[0_0_10px_#34d399]"></span>
                            Phase 2: Waste Stream Selection
                        </div>
                        
                        <h1 className="text-4xl md:text-6xl font-serif font-bold mb-6 leading-tight drop-shadow-lg tracking-tight">
                            Bio-Waste Stream MCDA
                        </h1>
                        <p className="text-lg md:text-xl text-emerald-50 font-serif italic max-w-3xl mx-auto mb-10 leading-relaxed font-light">
                            Multi-criteria decision analysis for prioritising waste streams in sustainable construction materials research
                        </p>
                        
                        {/* Top 3 Results */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-12 max-w-5xl mx-auto">
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg group">
                                <div className="text-emerald-200 text-xs uppercase tracking-wider font-bold mb-1 group-hover:text-emerald-100">
                                    ü•á Top Priority
                                </div>
                                <div className="text-2xl font-serif font-bold text-white">{winner.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {winner.score.toFixed(2)} / 5.0</div>
                                {winner.variabilityAdjusted && (
                                    <div className="mt-2 text-xs bg-cyan-400/30 text-white px-2 py-1 rounded">
                                        ‚ö†Ô∏è Variability adjusted
                                    </div>
                                )}
                            </div>
                            
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg">
                                <div className="text-cyan-200 text-xs uppercase tracking-wider font-bold mb-1">
                                    ü•à Second Priority
                                </div>
                                <div className="text-2xl font-serif font-bold text-white">{runnerUp.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {runnerUp.score.toFixed(2)} / 5.0</div>
                                {runnerUp.variabilityAdjusted && (
                                    <div className="mt-2 text-xs bg-cyan-400/30 text-white px-2 py-1 rounded">
                                        ‚ö†Ô∏è Variability adjusted
                                    </div>
                                )}
                            </div>
                            
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg">
                                <div className="text-amber-200 text-xs uppercase tracking-wider font-bold mb-1">
                                    ü•â Third Priority
                                </div>
                                <div className="text-2xl font-serif font-bold text-white">{thirdPlace.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {thirdPlace.score.toFixed(2)} / 5.0</div>
                                {thirdPlace.variabilityAdjusted && (
                                    <div className="mt-2 text-xs bg-cyan-400/30 text-white px-2 py-1 rounded">
                                        ‚ö†Ô∏è Variability adjusted
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    <div className="absolute bottom-0 left-0 w-full h-16 bg-slate-50 rounded-t-[50%] transform scale-x-150 translate-y-8 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]"></div>
                </header>

                {/* STICKY NAVIGATION */}
                <nav className="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-200/60 shadow-sm supports-[backdrop-filter]:bg-white/60">
                    <div className="container mx-auto max-w-7xl px-4">
                        <div className="flex justify-between items-center py-3">
                            <div className="flex space-x-2 overflow-x-auto scrollbar-hide py-1">
                                <TabButton tab="overview" label="Waste Overview" icon="üìä" />
                                <TabButton tab="matrix" label="MCDA Matrix" icon="üßÆ" />
                                <TabButton tab="sensitivity" label="Sensitivity" icon="‚öñÔ∏è" />
                                <TabButton tab="variability" label="Variability" icon="üîÅ" />
                                <TabButton tab="analytics" label="Analytics" icon="üìà" />
                                <TabButton tab="indicators" label="Indicators" icon="üß†" />
                                <TabButton tab="methodology" label="Methodology" icon="üî¨" />
                                <TabButton tab="references" label="References" icon="üìö" />
                            </div>
                        </div>
                    </div>
                </nav>

                <main className="container mx-auto px-4 md:px-6 py-12 max-w-7xl space-y-12">
                    
                    {/* TAB 1: Waste Overview */}
                    {activeTab === 'overview' && (
                        <div className="space-y-8">
                            <div className="text-center">
                                <h2 className="text-3xl font-serif font-bold text-slate-900 mb-3 flex items-center justify-center gap-3">
                                    <span>üìä</span> Waste Stream Overview
                                </h2>
                                <p className="text-slate-600 max-w-2xl mx-auto">
                                    Contextual grounding for the five prioritized bio-waste streams in Lebanon.
                                </p>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {WASTES.map((waste, idx) => {
                                    const meta = WASTE_METADATA[waste];
                                    return (
                                        <div key={waste} className="glass rounded-3xl p-6 shadow-lg border border-white/50 card-hover">
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex-1">
                                                    <h3 className="font-bold text-lg text-slate-800 mb-1">{waste}</h3>
                                                    <span className={`inline-block text-xs px-2 py-1 rounded-full font-semibold ${
                                                        meta.category === 'Plant-based' 
                                                            ? 'bg-emerald-100 text-emerald-700' 
                                                            : 'bg-cyan-100 text-cyan-700'
                                                    }`}>
                                                        {meta.category}
                                                    </span>
                                                </div>
                                            </div>

                                            <div className="space-y-3 text-sm">
                                                <div className="flex justify-between border-b border-slate-100 pb-2">
                                                    <span className="text-slate-500 font-medium">Annual Quantity:</span>
                                                    <span className="font-bold text-slate-800">{meta.quantity}</span>
                                                </div>
                                                <div className="flex justify-between border-b border-slate-100 pb-2">
                                                    <span className="text-slate-500 font-medium">Fiber Type:</span>
                                                    <span className="text-slate-800 text-right">{meta.fiberType}</span>
                                                </div>
                                                <div className="flex justify-between border-b border-slate-100 pb-2">
                                                    <span className="text-slate-500 font-medium">Seasonality:</span>
                                                    <span className="text-slate-800">{meta.seasonality}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-slate-500 font-medium">Data Confidence:</span>
                                                    <span className={`font-semibold ${
                                                        meta.confidence === 'High' ? 'text-emerald-600' : 'text-amber-600'
                                                    }`}>
                                                        {meta.confidence}
                                                    </span>
                                                </div>
                                            </div>

                                            <a href={meta.link} className="mt-4 inline-flex items-center gap-2 text-sm text-brand-secondary hover:text-brand-primary font-semibold transition">
                                                Learn more ‚Üí
                                            </a>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* TAB 2: MCDA Scoring Matrix */}
                    {activeTab === 'matrix' && (
                        <div className="space-y-6">
                            <div className="text-center">
                                <h2 className="text-3xl font-serif font-bold text-slate-900 mb-3 flex items-center justify-center gap-3">
                                    <span>üßÆ</span> MCDA Scoring Matrix
                                </h2>
                                <p className="text-slate-600 max-w-2xl mx-auto">
                                    Transparent display of locked scores, criterion weights, and weighted contributions.
                                </p>
                            </div>

                            <div className="bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-100">
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="text-xs text-slate-500 uppercase bg-slate-50 border-b-2 border-slate-200">
                                            <tr>
                                                <th className="px-6 py-4 font-bold tracking-wider sticky left-0 bg-slate-50">Waste Stream</th>
                                                {criteria.map(c => (
                                                    <th key={c.id} className="px-4 py-4 text-center min-w-[120px]">
                                                        <div className="font-bold text-slate-700">{c.id.toUpperCase()}</div>
                                                        <div className="text-[10px] text-brand-secondary font-mono bg-cyan-50 inline-block px-2 py-1 rounded mt-1">
                                                            Weight: {c.weight}%
                                                        </div>
                                                    </th>
                                                ))}
                                                <th className="px-6 py-4 text-right font-bold text-slate-800 sticky right-0 bg-slate-50">Total Score</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {results.map((res, idx) => (
                                                <tr key={res.name} className={`hover:bg-emerald-50/30 transition ${idx < 3 ? 'bg-emerald-50/10' : ''}`}>
                                                    <td className="px-6 py-4 font-semibold text-slate-800 sticky left-0 bg-white">
                                                        <div className="flex items-center gap-3">
                                                            <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${
                                                                idx === 0 ? 'bg-amber-500 text-white' :
                                                                idx === 1 ? 'bg-slate-400 text-white' :
                                                                idx === 2 ? 'bg-orange-600 text-white' :
                                                                'bg-slate-100 text-slate-500'
                                                            }`}>
                                                                {idx + 1}
                                                            </span>
                                                            {res.name}
                                                            {res.variabilityAdjusted && (
                                                                <span className="text-xs bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded" title="Position adjusted for material variability">
                                                                    ‚ö†Ô∏è Adjusted
                                                                </span>
                                                            )}
                                                        </div>
                                                    </td>
                                                    {criteria.map(c => {
                                                        const rawScore = res.rawScores[c.id];
                                                        const weighted = res.contributions[c.id];
                                                        return (
                                                            <td key={c.id} className="px-4 py-4 text-center" title={`Raw: ${rawScore} | Weighted: ${weighted.toFixed(2)}`}>
                                                                <div className="space-y-1">
                                                                    <div className={`inline-block px-3 py-1.5 rounded-lg text-sm font-bold ${
                                                                        rawScore >= 4 ? 'bg-emerald-100 text-emerald-800' :
                                                                        rawScore >= 3 ? 'bg-cyan-50 text-cyan-800' :
                                                                        rawScore >= 2 ? 'bg-amber-50 text-amber-700' :
                                                                        'bg-rose-50 text-rose-700'
                                                                    }`}>
                                                                        {rawScore}
                                                                    </div>
                                                                    <div className="text-xs text-slate-400 font-mono">
                                                                        √ó{c.weight}% = {weighted.toFixed(2)}
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        );
                                                    })}
                                                    <td className="px-6 py-4 text-right sticky right-0 bg-white">
                                                        <span className="text-xl font-bold text-slate-800">{res.score.toFixed(2)}</span>
                                                        <span className="text-xs text-slate-400 block">/ 5.0</span>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {/* Scoring Legend */}
                            <div className="glass rounded-2xl p-6 border border-white/50">
                                <h3 className="font-bold text-lg text-slate-800 mb-4">Scoring Logic</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm">
                                    {criteria.map(c => (
                                        <div key={c.id} className="bg-white/60 rounded-xl p-4 border border-slate-100">
                                            <div className="font-bold text-brand-primary mb-2">{c.name}</div>
                                            <div className="text-xs text-slate-600">{c.scoringLogic}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TAB 3: Sensitivity Analysis */}
                    {activeTab === 'sensitivity' && (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            {/* Sidebar: Weight Controls */}
                            <aside className="lg:col-span-4 space-y-6">
                                <div className="glass rounded-3xl p-6 shadow-xl sticky top-24 border border-white/50">
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="font-serif font-bold text-slate-800 text-lg flex items-center gap-2">
                                            <span className="text-brand-primary">üéõÔ∏è</span> Weight Controls
                                        </h2>
                                        <button onClick={resetData} className="text-xs font-bold text-brand-secondary hover:text-cyan-700 bg-cyan-50 px-3 py-1 rounded-full transition">
                                            Reset
                                        </button>
                                    </div>

                                    {/* Presets */}
                                    <div className="mb-6 space-y-2">
                                        <div className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Quick Presets</div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <button onClick={() => applyPreset('equal')} className="px-3 py-2 text-xs font-semibold bg-slate-100 hover:bg-slate-200 rounded-lg transition">
                                                Equal Weights
                                            </button>
                                            <button onClick={() => applyPreset('supply')} className="px-3 py-2 text-xs font-semibold bg-amber-50 hover:bg-amber-100 text-amber-700 rounded-lg transition">
                                                Supply-Dominant
                                            </button>
                                            <button onClick={() => applyPreset('environmental')} className="px-3 py-2 text-xs font-semibold bg-emerald-50 hover:bg-emerald-100 text-emerald-700 rounded-lg transition">
                                                Environment-Dominant
                                            </button>
                                            <button onClick={() => applyPreset('technical')} className="px-3 py-2 text-xs font-semibold bg-cyan-50 hover:bg-cyan-100 text-cyan-700 rounded-lg transition">
                                                Technical-Dominant
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4 max-h-[50vh] overflow-y-auto pr-2">
                                        {criteria.map(c => (
                                            <div key={c.id} className="bg-white/60 rounded-2xl p-4 shadow-sm">
                                                <div className="flex justify-between items-center text-sm mb-3">
                                                    <span className="font-bold text-slate-800 w-2/3 leading-tight">{c.name}</span>
                                                    <span className="font-mono font-bold text-brand-primary bg-emerald-50 px-2 py-1 rounded-lg text-xs">
                                                        {c.weight}%
                                                    </span>
                                                </div>
                                                <input 
                                                    type="range" 
                                                    min="0" 
                                                    max="50"
                                                    step="1"
                                                    value={c.weight} 
                                                    onChange={(e) => handleWeightChange(c.id, e.target.value)}
                                                    className="w-full"
                                                />
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-4 pt-4 border-t border-slate-200 flex justify-between text-sm font-bold text-slate-700">
                                        <span>Total Weight</span>
                                        <span className={criteria.reduce((a,b) => a+b.weight, 0) !== 100 ? "text-red-500" : "text-brand-primary"}>
                                            {criteria.reduce((a,b) => a+b.weight, 0).toFixed(0)}%
                                        </span>
                                    </div>
                                </div>
                            </aside>

                            {/* Main Content: Charts */}
                            <div className="lg:col-span-8 space-y-8">
                                <div className="glass p-6 rounded-3xl shadow-lg border border-white/50">
                                    <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                        <span className="text-brand-primary">üìä</span> Live Ranking Update
                                    </h3>
                                    <BarChart data={results} colors={COLORS} />
                                </div>

                                <div className="glass p-6 rounded-3xl shadow-lg border border-white/50">
                                    <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                        <span className="text-brand-accent">üìã</span> Ranking Table
                                    </h3>
                                    <RankingTable results={results} />
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TAB 4: Variability Toggle */}
                    {activeTab === 'variability' && (
                        <div className="space-y-8">
                            <div className="text-center">
                                <h2 className="text-3xl font-serif font-bold text-slate-900 mb-3 flex items-center justify-center gap-3">
                                    <span>üîÅ</span> Material Variability Control
                                </h2>
                                <p className="text-slate-600 max-w-3xl mx-auto">
                                    Scientific breadth enforcement: Ensure material-class diversity (plant-based + animal-based) in final selection.
                                </p>
                            </div>

                            <div className="glass rounded-3xl p-8 shadow-xl border border-white/50 max-w-3xl mx-auto">
                                <div className="flex items-start gap-4 mb-6">
                                    <input 
                                        type="checkbox" 
                                        id="variability-toggle"
                                        checked={enforceVariability}
                                        onChange={(e) => setEnforceVariability(e.target.checked)}
                                        className="mt-1 w-5 h-5 accent-brand-primary cursor-pointer"
                                    />
                                    <div className="flex-1">
                                        <label htmlFor="variability-toggle" className="font-bold text-lg text-slate-800 cursor-pointer block mb-2">
                                            Enforce Material Variability (Plant + Animal)
                                        </label>
                                        <p className="text-sm text-slate-600 leading-relaxed">
                                            When enabled, if the top 3 ranked wastes are all plant-based, 
                                            <span className="font-semibold text-brand-primary"> Poultry Feather Waste </span> 
                                            will automatically be included at rank #3 to ensure animal-based fiber representation.
                                        </p>
                                    </div>
                                </div>

                                {enforceVariability && (
                                    <div className="bg-cyan-50 border-l-4 border-cyan-500 p-4 rounded-lg">
                                        <div className="flex items-start gap-3">
                                            <span className="text-2xl">‚ö†Ô∏è</span>
                                            <div>
                                                <div className="font-bold text-cyan-900 mb-1">Variability Enforcement Active</div>
                                                <p className="text-sm text-cyan-800">
                                                    This is <strong>not bias</strong> ‚Äî it's experimental design control. 
                                                    Including both plant-based (cellulosic) and animal-based (keratin) fibers 
                                                    ensures broader scientific coverage and demonstrates material versatility 
                                                    across protein/polysaccharide chemistries.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="mt-6 pt-6 border-t border-slate-200">
                                    <h4 className="font-bold text-slate-700 mb-3">Current Top 3:</h4>
                                    <div className="space-y-2">
                                        {results.slice(0, 3).map((r, idx) => (
                                            <div key={r.name} className={`flex items-center justify-between p-3 rounded-lg ${
                                                r.variabilityAdjusted ? 'bg-cyan-100 border-2 border-cyan-400' : 'bg-slate-50'
                                            }`}>
                                                <div className="flex items-center gap-3">
                                                    <span className="font-bold text-lg">{idx + 1}.</span>
                                                    <span className="font-semibold">{r.name}</span>
                                                    <span className={`text-xs px-2 py-0.5 rounded-full ${
                                                        r.category === 'Plant-based' 
                                                            ? 'bg-emerald-100 text-emerald-700' 
                                                            : 'bg-cyan-500 text-white'
                                                    }`}>
                                                        {r.category}
                                                    </span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="font-mono text-sm text-slate-600">{r.score.toFixed(2)}</span>
                                                    {r.variabilityAdjusted && (
                                                        <span className="text-xs font-bold text-cyan-700 bg-cyan-200 px-2 py-1 rounded">
                                                            Variability Adjusted
                                                        </span>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Justification */}
                            <div className="glass rounded-2xl p-6 border border-white/50 max-w-3xl mx-auto">
                                <h3 className="font-bold text-lg text-slate-800 mb-4 flex items-center gap-2">
                                    <span>üìñ</span> Scientific Rationale
                                </h3>
                                <div className="prose prose-sm text-slate-600 space-y-3">
                                    <p>
                                        <strong className="text-brand-primary">Why enforce variability?</strong> 
                                        PhD research on bio-based construction materials should demonstrate versatility 
                                        across different biochemical compositions:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2">
                                        <li>
                                            <strong>Plant-based wastes</strong> (banana, wheat, olive, grape) are primarily cellulosic/lignocellulosic
                                        </li>
                                        <li>
                                            <strong>Animal-based wastes</strong> (poultry feathers) are protein-based (keratin)
                                        </li>
                                        <li>
                                            Testing both categories proves material concept works across <strong>fundamentally different fiber chemistries</strong>
                                        </li>
                                        <li>
                                            Strengthens publication potential by showing <strong>broader applicability</strong>
                                        </li>
                                    </ul>
                                    <p className="text-sm italic bg-slate-50 p-3 rounded-lg border-l-4 border-brand-primary">
                                        Note: This is a methodological choice for experimental breadth, not a manipulation of MCDA scores. 
                                        All scores remain locked and transparent.
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TAB 5: Visual Analytics */}
                    {activeTab === 'analytics' && (
                        <div className="space-y-8">
                            <div className="text-center">
                                <h2 className="text-3xl font-serif font-bold text-slate-900 mb-3 flex items-center justify-center gap-3">
                                    <span>üìà</span> Visual Analytics
                                </h2>
                                <p className="text-slate-600 max-w-2xl mx-auto">
                                    Dynamic charts showing criteria performance, contributions, and ranking evolution.
                                </p>
                            </div>

                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover">
                                    <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                        <span className="text-brand-accent">üï∏Ô∏è</span> Criteria Performance (Radar)
                                    </h3>
                                    <RadarChart data={results} criteria={criteria} colors={COLORS} />
                                </div>

                                <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover">
                                    <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                        <span className="text-pink-500">üç©</span> Criterion Contribution
                                    </h3>
                                    <div className="mb-4">
                                        <select 
                                            value={selectedWaste || winner.name}
                                            onChange={(e) => setSelectedWaste(e.target.value)}
                                            className="w-full px-4 py-2 rounded-lg border border-slate-200 font-semibold text-slate-700 bg-white"
                                        >
                                            {results.map(r => (
                                                <option key={r.name} value={r.name}>{r.name}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <DoughnutChart wasteData={activeWaste} criteria={criteria} />
                                </div>

                                <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover lg:col-span-2">
                                    <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                        <span className="text-violet-500">üìä</span> Stacked Contribution Chart
                                    </h3>
                                    <StackedBarChart data={results} criteria={criteria} />
                                </div>
                            </div>
                        </div>
                    )}

                    {/* TAB 6: Indicators & Criteria */}
                    {activeTab === 'indicators' && (
                        <div className="space-y-10">
                            <div className="text-center">
                                <h2 className="text-3xl font-serif font-bold text-slate-900 mb-3 flex items-center justify-center gap-3">
                                    <span>üß†</span> Criteria Indicators
                                </h2>
                                <p className="text-slate-600 max-w-2xl mx-auto">
                                    Detailed breakdown of indicators, scoring rubrics, and weight justifications.
                                </p>
                            </div>

                            <div className="grid gap-8">
                                {criteria.map((c) => (
                                    <div key={c.id} className="glass rounded-3xl p-8 shadow-lg border border-white/50 card-hover">
                                        <div className="flex items-start justify-between mb-6">
                                            <div>
                                                <h3 className="font-bold text-2xl text-slate-800 mb-2">{c.name}</h3>
                                                <div className="inline-block bg-emerald-50 text-brand-primary px-3 py-1 rounded-lg font-mono font-bold text-sm">
                                                    Weight: {c.weight}%
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-6">
                                            <div>
                                                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Definition</h4>
                                                <p className="text-sm text-slate-700 leading-relaxed">{c.description}</p>
                                            </div>
                                            <div>
                                                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Rationale</h4>
                                                <p className="text-sm text-slate-700 leading-relaxed italic">{c.rationale}</p>
                                            </div>
                                        </div>

                                        <div className="mt-6 pt-6 border-t border-slate-200 grid md:grid-cols-2 gap-6">
                                            <div>
                                                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Indicator</h4>
                                                <p className="text-sm text-slate-700 font-semibold">{c.indicator}</p>
                                                <p className="text-xs text-slate-500 mt-1">Source: {c.source}</p>
                                            </div>
                                            <div>
                                                <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Scoring Rubric</h4>
                                                <p className="text-xs text-slate-600 font-mono bg-slate-50 p-3 rounded-lg">{c.scoringLogic}</p>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* TAB 7: Methodology */}
                    {activeTab === 'methodology' && (
                        <div className="glass rounded-[2.5rem] p-8 md:p-14 shadow-2xl border border-white/50">
                            <h2 className="text-3xl font-serif font-bold text-slate-800 mb-8 flex items-center gap-4">
                                <span className="text-brand-primary bg-emerald-100 p-2 rounded-xl text-2xl">üî¨</span> 
                                Methodology & Framework
                            </h2>
                            
                            <div className="prose max-w-none text-slate-600 space-y-8">
                                <section>
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Why MCDA?</h3>
                                    <p className="leading-relaxed">
                                        Multi-Criteria Decision Analysis (MCDA) is the standard framework for waste prioritisation 
                                        in circular materials research. It allows transparent, quantitative comparison across 
                                        multiple dimensions: supply, handling, environmental urgency, technical evidence, 
                                        research novelty, and global scalability.
                                    </p>
                                    <p className="leading-relaxed">
                                        Unlike subjective selection, MCDA requires explicit justification for every score and weight, 
                                        making the decision process <strong className="text-brand-primary">auditable and defensible</strong> 
                                        to supervisors, examiners, and peer reviewers.
                                    </p>
                                </section>

                                <section className="bg-slate-50 p-6 rounded-2xl border-l-4 border-brand-primary">
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Filtration ‚Üí MCDA Logic Chain</h3>
                                    <ol className="list-decimal pl-5 space-y-2">
                                        <li><strong>Phase 1:</strong> Region selection MCDA identified Lebanon as optimal study region</li>
                                        <li><strong>Filtration:</strong> Lebanese waste mapping dataset filtered to 5 viable bio-wastes</li>
                                        <li><strong>Phase 2 (this dashboard):</strong> MCDA applied to prioritise these 5 waste streams</li>
                                        <li><strong>Output:</strong> Top 3 ranked wastes selected for experimental materials research</li>
                                    </ol>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Scoring Approach</h3>
                                    <p className="leading-relaxed">
                                        All scores (1-5 scale) are locked based on objective indicators:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3">
                                        <li><strong>C1 (Supply):</strong> National waste quantity thresholds</li>
                                        <li><strong>C2 (Handling):</strong> Pre-treatment complexity from literature</li>
                                        <li><strong>C3 (Environmental):</strong> Peer-reviewed evidence of disposal harm</li>
                                        <li><strong>C4 (Technical):</strong> Number/quality of construction material studies</li>
                                        <li><strong>C5 (Novelty):</strong> Research gap analysis from publication review</li>
                                        <li><strong>C6 (Global):</strong> FAOSTAT global production data</li>
                                    </ul>
                                    <p className="leading-relaxed mt-4">
                                        <strong>No subjective scoring.</strong> Every number is traceable to data or literature.
                                    </p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Weighting Philosophy</h3>
                                    <p className="leading-relaxed">
                                        Weights reflect PhD priorities:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3">
                                        <li><strong>C4 (25%):</strong> Technical evidence is highest ‚Äî PhD depends on proven material feasibility</li>
                                        <li><strong>C1 & C3 (20% each):</strong> Supply and environmental urgency are co-equal strategic drivers</li>
                                        <li><strong>C2 (15%):</strong> Handling matters but shouldn't override core drivers</li>
                                        <li><strong>C5 & C6 (10% each):</strong> Novelty and global scale are important but secondary</li>
                                    </ul>
                                    <p className="leading-relaxed mt-4">
                                        Weights are <strong>adjustable via sensitivity analysis</strong> to test ranking robustness.
                                    </p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Sensitivity Analysis</h3>
                                    <p className="leading-relaxed">
                                        Four preset scenarios test how rankings change under different priorities:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3">
                                        <li><strong>Equal weights:</strong> All criteria treated identically</li>
                                        <li><strong>Supply-dominant:</strong> C1 gets 40% weight</li>
                                        <li><strong>Environmental-dominant:</strong> C3 gets 40% weight</li>
                                        <li><strong>Technical-dominant:</strong> C4 gets 45% weight</li>
                                    </ul>
                                    <p className="leading-relaxed mt-4">
                                        If top 3 wastes remain stable across scenarios, the ranking is <strong className="text-brand-primary">robust</strong>.
                                    </p>
                                </section>

                                <section className="bg-cyan-50 p-6 rounded-2xl border-l-4 border-cyan-500">
                                    <h3 className="text-xl font-bold text-cyan-900 mb-3">Variability Enforcement Logic</h3>
                                    <p className="leading-relaxed text-cyan-800">
                                        The "Enforce Material Variability" toggle is <strong>not bias</strong> ‚Äî it's experimental design control.
                                    </p>
                                    <p className="leading-relaxed text-cyan-800 mt-3">
                                        <strong>Logic:</strong> If top 3 wastes are all plant-based (cellulosic), the toggle automatically 
                                        includes Poultry Feather Waste at rank #3 to ensure the PhD covers both:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3 text-cyan-800">
                                        <li>Plant-based fibers (polysaccharide chemistry)</li>
                                        <li>Animal-based fibers (protein/keratin chemistry)</li>
                                    </ul>
                                    <p className="leading-relaxed text-cyan-800 mt-3">
                                        This ensures <strong>scientific breadth</strong> and demonstrates material versatility 
                                        across fundamentally different biochemical compositions ‚Äî a strength in academic publishing.
                                    </p>
                                </section>

                                <section>
                                    <h3 className="text-xl font-bold text-slate-800 mb-3">Handling Qualitative Indicators</h3>
                                    <p className="leading-relaxed">
                                        Some criteria (e.g., C2 Handling, C3 Environmental) are qualitative. Scores are anchored to:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3">
                                        <li>Documented processing steps (drying, sterilisation, etc.)</li>
                                        <li>Peer-reviewed evidence of environmental harm</li>
                                        <li>Established industry practices</li>
                                    </ul>
                                    <p className="leading-relaxed mt-4">
                                        Qualitative ‚â† subjective. Every score is justified in the <strong>Indicators</strong> tab 
                                        with explicit references.
                                    </p>
                                </section>

                                <section className="bg-emerald-50 p-6 rounded-2xl">
                                    <h3 className="text-xl font-bold text-emerald-900 mb-3">Publication Readiness</h3>
                                    <p className="leading-relaxed text-emerald-800">
                                        This MCDA framework is designed to be <strong>copy-paste ready</strong> for:
                                    </p>
                                    <ul className="list-disc pl-5 space-y-2 mt-3 text-emerald-800">
                                        <li>PhD methodology chapter (full transparency)</li>
                                        <li>Journal articles (reproducible decision framework)</li>
                                        <li>Supervisor meetings (clear rationale for waste selection)</li>
                                        <li>Funder reports (data-driven decision making)</li>
                                    </ul>
                                </section>
                            </div>
                        </div>
                    )}

                    {/* TAB 8: References */}
                    {activeTab === 'references' && (
                        <div className="glass rounded-[2.5rem] p-8 md:p-14 shadow-2xl border border-white/50">
                            <h2 className="text-3xl font-serif font-bold text-slate-800 mb-8 flex items-center gap-4">
                                <span className="text-brand-primary bg-emerald-100 p-2 rounded-xl text-2xl">üìö</span> 
                                References
                            </h2>

                            <div className="prose max-w-none text-slate-600">
                                <p className="text-lg mb-8 text-slate-700">
                                    All criteria are anchored to peer-reviewed literature, FAO datasets, 
                                    and established waste management frameworks. This section lists key references 
                                    organized by criterion.
                                </p>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C1: Recoverable Supply Scale
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>National waste mapping dataset (Lebanon, 2023). Ministry of Environment waste composition study.</li>
                                        <li>FAO (2023). FAOSTAT Crops and Livestock Products database. Retrieved from https://www.fao.org/faostat/en/#data/QCL</li>
                                    </ul>
                                </section>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C2: Handling & Pre-treatment Burden
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>Padam, B. S., et al. (2014). Banana by-products: an under-utilized renewable food biomass. <em>Journal of Food Science & Nutrition</em>, 54(12), 1637‚Äì1649.</li>
                                        <li>Dermeche, S., et al. (2013). Olive mill wastes: biochemical characterization and environmental impact. <em>Process Biochemistry</em>, 48(10), 1526‚Äì1532.</li>
                                        <li>Tesfaye, T., et al. (2017). Feather waste management and valorisation. <em>Waste Management</em>, 68, 626‚Äì638.</li>
                                    </ul>
                                </section>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C3: Environmental Urgency & Disposal Burden
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>Khdair, A. I., & Abu-Rumman, G. (2020). Characteristics and environmental impacts of olive mill wastewater. <em>Journal of Environmental Management</em>, 255, 109988. https://doi.org/10.1016/j.jenvman.2019.109988</li>
                                        <li>Dermeche, S., et al. (2013). Olive mill wastes: biochemical characterization and environmental impact. <em>Process Biochemistry</em>, 48(10), 1526‚Äì1532.</li>
                                        <li>Mohapatra, D., et al. (2010). Post-harvest processing and utilization of banana pseudostem. <em>Journal of Food Science & Technology</em>, 47(5), 502‚Äì508.</li>
                                        <li>Guan, D., et al. (2017). Air pollutant emissions from straw open burning. <em>Atmospheric Environment</em>, 148, 208‚Äì215.</li>
                                        <li>Beres, C., et al. (2017). Valorisation of grape pomace. <em>Journal of Cleaner Production</em>, 149, 710‚Äì721.</li>
                                        <li>Sharma, S., & Gupta, A. (2016). Sustainable management of poultry waste. <em>Journal of Cleaner Production</em>, 112, 323‚Äì337.</li>
                                    </ul>
                                </section>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C4: Construction & Material Evidence Strength
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>Belaidi, A., et al. (2025). Olive pomace ash as partial cement substitute: Fresh, mechanical and durability properties of mortar. <em>Materials</em> https://www.mdpi.com/1996-1944/18/11/2667</li>
                                        <li>Lamichhane, S., et al. (2024). Mechanical performance of banana fiber reinforced cement mortar. <em>Heliyon</em>, 10(3), e25933. https://www.sciencedirect.com/science/article/pii/S2405844024066830</li>
                                        <li>Ouda, M., et al. (2025). A Comprehensive Review of Sustainable Thermal and Acoustic Insulation Materials from Various Waste Sources <em>Buildings</em>https://www.mdpi.com/2075-5309/15/16/2876</li>
                                        <li>Baheel, N., et al. (2024). Effect of wheat straw ash as cementitious material on the mechanical characteristics and embodied carbon of concrete reinforced with coir fiber <em>Heliyon</em>, https://www.sciencedirect.com/science/article/pii/S240584402400344X</li>
                                        <li>Taghiyari, H, et al. (2020). Engineering composites made from wood and chicken feather: Mechanical and physical properties. <em>Polymers</em>https://www.mdpi.com/2073-4360/12/4/857</li>
                                        <li>Parlato, M., et al. (2025). Towards Circular Biobased Materials: Enhancing Unfired Adobe with Grape Pomace‚ÄîA Comprehensive Analysis <em>Agronomy</em>https://www.mdpi.com/2073-4395/15/11/2605</li>
                                    </ul>
                                </section>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C5: Research Novelty & Gap Analysis
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>Same references as C4, analyzed for research saturation and novelty potential</li>
                                        <li>Scopus & Web of Science publication trend analysis (2018-2024) for construction applications</li>
                                    </ul>
                                </section>

                                <section className="mb-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4 border-b-2 border-brand-primary pb-2">
                                        C6: Global Scalability Potential
                                    </h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>Food and Agriculture Organization (FAO). (2023). FAOSTAT ‚Äì Crops and livestock products (QCL): World production, 2023. https://www.fao.org/faostat/en/#data/QCL</li>
                                    </ul>
                                </section>

                                <section className="bg-slate-50 p-6 rounded-2xl mt-10">
                                    <h3 className="text-xl font-bold text-slate-800 mb-4">Additional Resources</h3>
                                    <ul className="space-y-3 text-sm">
                                        <li>SWEEP-Net (2023). Lebanon Waste Management Country Profile.</li>
                                        <li>World Bank (2022). What a Waste 2.0 Global Database.</li>
                                        <li>Ellen MacArthur Foundation (2021). Circular Economy in Construction Materials.</li>
                                    </ul>
                                </section>
                            </div>
                        </div>
                    )}

                </main>

                {/* FOOTER */}
                <footer className="bg-slate-900 text-slate-400 py-16 border-t border-slate-800 mt-auto">
                    <div className="container mx-auto max-w-6xl text-center px-4">
                        <div className="mb-8">
                            <span className="text-2xl font-serif text-slate-200 font-bold tracking-tight">PhD Research Dashboard</span>
                        </div>
                        <div className="grid md:grid-cols-3 gap-8 max-w-3xl mx-auto mb-10 text-sm">
                            <div><h4 className="text-slate-300 font-bold mb-2">Phase</h4><p>Waste Stream Selection MCDA</p></div>
                            <div><h4 className="text-slate-300 font-bold mb-2">Focus</h4><p>Sustainable Construction Materials</p></div>
                            <div><h4 className="text-slate-300 font-bold mb-2">Region</h4><p>Lebanon</p></div>
                        </div>
                        <div className="text-xs text-slate-500">
                            Built with React + Chart.js | Transparent, Auditable, Supervisor-Grade
                        </div>
                    </div>
                </footer>
            </div>
        );
    };

    // --- Chart Components ---

    const BarChart = ({ data, colors }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();

            const ctx = canvasRef.current.getContext('2d');
            
            chartRef.current = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: [{
                        label: 'Total Score',
                        data: data.map(d => d.score),
                        backgroundColor: data.map(d => colors[d.name]),
                        borderRadius: 8,
                        barThickness: 40,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            padding: 12,
                            titleFont: {family: "'Lora', serif", size: 14},
                            bodyFont: {family: "'Inter', sans-serif", size: 12},
                        }
                    },
                    scales: {
                        x: { 
                            beginAtZero: true, 
                            max: 5,
                            grid: { color: '#f1f5f9' },
                            title: { display: true, text: 'Score (0-5)' }
                        },
                        y: { 
                            grid: { display: false }
                        }
                    }
                }
            });

            return () => {
                if (chartRef.current) chartRef.current.destroy();
            }
        }, [data, colors]);

        return <div className="relative h-80 w-full"><canvas ref={canvasRef} /></div>;
    };

    const RadarChart = ({ data, criteria, colors }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();
            const ctx = canvasRef.current.getContext('2d');
            
            const datasets = data.slice(0, 5).map(d => ({
                label: d.name,
                data: criteria.map(c => d.rawScores[c.id]),
                backgroundColor: colors[d.name] + '20',
                borderColor: colors[d.name],
                borderWidth: 2,
                pointBackgroundColor: colors[d.name],
                pointRadius: 3,
                pointHoverRadius: 5
            }));

            chartRef.current = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: criteria.map(c => c.id.toUpperCase()),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: { 
                                font: {family: "'Inter', sans-serif", size: 11, weight: '600'}, 
                                color: '#64748b' 
                            },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: { 
                                stepSize: 1,
                                font: { size: 10 },
                                backdropColor: 'transparent'
                            }
                        }
                    },
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                usePointStyle: true, 
                                boxWidth: 8, 
                                padding: 15,
                                font: {family: "'Inter', sans-serif", size: 11}
                            } 
                        },
                        tooltip: { 
                            backgroundColor: 'rgba(15, 23, 42, 0.9)', 
                            padding: 12 
                        }
                    }
                }
            });

            return () => { if (chartRef.current) chartRef.current.destroy(); }
        }, [data, criteria, colors]);

        return <div className="relative h-96 w-full"><canvas ref={canvasRef} /></div>;
    };

    const DoughnutChart = ({ wasteData, criteria }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();
            if (!wasteData) return;

            const ctx = canvasRef.current.getContext('2d');
            const labels = criteria.map(c => c.id.toUpperCase());
            const values = criteria.map(c => wasteData.contributions[c.id]);
            const palette = ['#059669', '#0891b2', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1'];

            chartRef.current = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: palette,
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { 
                            position: 'right', 
                            labels: { 
                                boxWidth: 12, 
                                font: { size: 11 },
                                padding: 10
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.label}: ${ctx.raw.toFixed(2)} pts (${((ctx.raw / wasteData.score) * 100).toFixed(1)}%)`
                            }
                        }
                    }
                }
            });
            return () => { if (chartRef.current) chartRef.current.destroy(); }
        }, [wasteData, criteria]);

        return <div className="relative h-80 w-full"><canvas ref={canvasRef} /></div>;
    };

    const StackedBarChart = ({ data, criteria }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();

            const ctx = canvasRef.current.getContext('2d');
            const palette = ['#059669', '#0891b2', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1'];

            const datasets = criteria.map((c, idx) => ({
                label: c.id.toUpperCase(),
                data: data.map(d => d.contributions[c.id]),
                backgroundColor: palette[idx % palette.length],
                borderRadius: 4,
            }));

            chartRef.current = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'top', 
                            labels: { 
                                usePointStyle: true, 
                                boxWidth: 8, 
                                padding: 15,
                                font: {family: "'Inter', sans-serif", size: 11}
                            } 
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            padding: 12,
                            callbacks: {
                                footer: (items) => 'Total: ' + items.reduce((a, b) => a + b.raw, 0).toFixed(2)
                            }
                        }
                    },
                    scales: {
                        x: { 
                            stacked: true, 
                            grid: { display: false } 
                        },
                        y: { 
                            stacked: true, 
                            beginAtZero: true, 
                            max: 5,
                            grid: { color: '#f1f5f9', borderDash: [4, 4] },
                            title: { display: true, text: 'Score Contribution' }
                        }
                    }
                }
            });

            return () => {
                if (chartRef.current) chartRef.current.destroy();
            }
        }, [data, criteria]);

        return <div className="relative h-96 w-full"><canvas ref={canvasRef} /></div>;
    };

    const RankingTable = ({ results }) => {
        return (
            <div className="overflow-x-auto">
                <table className="w-full text-sm">
                    <thead className="bg-slate-50 border-b-2 border-slate-200">
                        <tr>
                            <th className="px-4 py-3 text-left font-bold text-slate-700">Rank</th>
                            <th className="px-4 py-3 text-left font-bold text-slate-700">Waste Stream</th>
                            <th className="px-4 py-3 text-left font-bold text-slate-700">Category</th>
                            <th className="px-4 py-3 text-right font-bold text-slate-700">Score</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                        {results.map((r, idx) => (
                            <tr key={r.name} className={`hover:bg-slate-50 transition ${idx < 3 ? 'bg-emerald-50/20' : ''}`}>
                                <td className="px-4 py-3">
                                    <span className={`inline-flex items-center justify-center w-8 h-8 rounded-full font-bold text-sm ${
                                        idx === 0 ? 'bg-amber-500 text-white' :
                                        idx === 1 ? 'bg-slate-400 text-white' :
                                        idx === 2 ? 'bg-orange-600 text-white' :
                                        'bg-slate-100 text-slate-600'
                                    }`}>
                                        {idx + 1}
                                    </span>
                                </td>
                                <td className="px-4 py-3 font-semibold text-slate-800">
                                    {r.name}
                                    {r.variabilityAdjusted && (
                                        <span className="ml-2 text-xs bg-cyan-100 text-cyan-700 px-2 py-0.5 rounded">
                                            ‚ö†Ô∏è Adjusted
                                        </span>
                                    )}
                                </td>
                                <td className="px-4 py-3">
                                    <span className={`inline-block text-xs px-2 py-1 rounded-full font-semibold ${
                                        r.category === 'Plant-based' 
                                            ? 'bg-emerald-100 text-emerald-700' 
                                            : 'bg-cyan-100 text-cyan-700'
                                    }`}>
                                        {r.category}
                                    </span>
                                </td>
                                <td className="px-4 py-3 text-right">
                                    <span className="text-lg font-bold text-slate-800">{r.score.toFixed(2)}</span>
                                    <span className="text-xs text-slate-400 ml-1">/ 5.0</span>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>
