<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhD Region Selection MCDA - Dashboard</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['Lora', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#059669',   /* Emerald 600 */
                            secondary: '#0891b2', /* Cyan 600 */
                            dark: '#0f172a',      /* Slate 900 */
                            accent: '#f59e0b',    /* Amber 500 */
                            light: '#f0fdf4',     /* Emerald 50 */
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
             transform: translateY(-5px);
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
             border-color: #34d399; /* Emerald 400 */
        }
        
        /* Custom Slider Styling to match theme */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #059669; /* Brand Primary */
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #e2e8f0;
            border-radius: 2px;
        }

        /* Sub slider for indicators */
        .sub-slider::-webkit-slider-thumb {
            background: #0891b2; /* Brand Secondary */
            height: 12px;
            width: 12px;
            margin-top: -4px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-emerald-200 relative">

<div id="root"></div>

<script type="text/babel">

    const { useState, useEffect, useMemo, useRef } = React;

    // --- Data Initialization ---
    const INITIAL_CRITERIA = [
        { 
            id: 'c1', 
            name: 'C1: Material Feasibility', 
            weight: 25, 
            group: 'Feasibility',
            description: 'Core scientific driver: Biomass availability, agro-industrial strength, and replicability.',
            rationale: "Waste-based biomaterials require sufficient biomass and industrial residue streams to maintain lab testing and scaling. Without strong technical potential, the project cannot progress regardless of policy or logistics.",
            indicators: [
                { id: 'i1', name: "Biomass Potential", contribution: 40, desc: "Measures actual feedstock availability (agricultural residues, MSW). Logic: Biomass availability overwhelmingly determines feasibility; no technology can compensate for insufficient residues.", scores: { "Lebanon": 3.0, "UK": 2.0, "KSA": 3.0, "Brazil": 4.0, "Indonesia": 5.0 } },
                { id: 'i2', name: "Agro-Industrial Strength", contribution: 27, desc: "Assesses the stability of residue generation from processing industries. Logic: Industrial residues offer consistency essential for reproducible material experiments.", scores: { "Lebanon": 2.0, "UK": 2.0, "KSA": 3.0, "Brazil": 5.0, "Indonesia": 4.0 } },
                { id: 'i3', name: "Urgency of Valorisation", contribution: 17, desc: "Reflects environmental drivers and societal pressure. Logic: High urgency implies stronger real-world relevance and potential for immediate impact.", scores: { "Lebanon": 5.0, "UK": 1.0, "KSA": 3.0, "Brazil": 4.0, "Indonesia": 4.0 } },
                { id: 'i4', name: "Replicability", contribution: 16, desc: "Ensures findings generalize to similar countries. Logic: Enhances the academic value and publication potential of the research beyond the specific case study.", scores: { "Lebanon": 5.0, "UK": 3.0, "KSA": 4.0, "Brazil": 5.0, "Indonesia": 5.0 } }
            ]
        },
        { 
            id: 'c2', 
            name: 'C2: Env. Opportunity', 
            weight: 15, 
            group: 'Strategic',
            description: 'Waste mismanagement levels, CO2 reduction potential, and environmental urgency.',
            rationale: "Reflects the urgency of waste valorisation. Regions with high waste mismanagement offer higher environmental impact potential for the PhD.",
            indicators: [
                { id: 'i1', name: "Mismanaged Waste Share", contribution: 67, desc: "Quantifies the percentage of waste not formally managed. Logic: High mismanagement indicates a critical environmental crisis and high leverage for improvement.", scores: { "Lebanon": 5.0, "UK": 1.0, "KSA": 2.0, "Brazil": 4.0, "Indonesia": 3.0 } },
                { id: 'i2', name: "Waste-Sector CO2 Emissions", contribution: 33, desc: "Measures the sector's contribution to national GHG emissions. Logic: Targets regions where waste valorisation can significantly contribute to decarbonisation goals.", scores: { "Lebanon": 5.0, "UK": 1.0, "KSA": 4.0, "Brazil": 3.0, "Indonesia": 2.0 } }
            ]
        },
        { 
            id: 'c3', 
            name: 'C3: Market Relevance', 
            weight: 15, 
            group: 'Strategic',
            description: 'Construction sector GDP share, import dependency, and societal need.',
            rationale: "Ensures the research addresses a real market need (construction demand) and societal pressure, increasing the likelihood of adoption.",
            indicators: [
                { id: 'i1', name: "Construction Sector Share of GDP", contribution: 33, desc: "Indicates the economic weight of the construction industry. Logic: A large sector ensures a viable market exists to absorb the developed materials.", scores: { "Lebanon": 1.0, "UK": 2.0, "KSA": 5.0, "Brazil": 3.0, "Indonesia": 4.0 } },
                { id: 'i2', name: "Import Dependency", contribution: 67, desc: "Measures reliance on imported construction materials. Logic: High import dependency creates a strategic imperative for local, sovereignty-boosting alternatives.", scores: { "Lebanon": 5.0, "UK": 4.0, "KSA": 1.0, "Brazil": 3.0, "Indonesia": 2.0 } }
            ]
        },
        { 
            id: 'c4', 
            name: 'C4: Policy Support', 
            weight: 10, 
            group: 'Strategic',
            description: 'Circular economy strategies, regulatory quality, and institutional frameworks.',
            rationale: "Regulatory frameworks facilitate or hinder the transition to circular materials. Essential for implementation feasibility.",
            indicators: [
                { id: 'i1', name: "CE/Waste Strategy Status", contribution: 60, desc: "Assesses the existence and maturity of Circular Economy roadmaps. Logic: Existing strategies provide the necessary political framework for adoption.", scores: { "Lebanon": 1.0, "UK": 5.0, "KSA": 3.0, "Brazil": 4.0, "Indonesia": 3.0 } },
                { id: 'i2', name: "Regulatory Quality", contribution: 40, desc: "Evaluates institutional capacity to enforce standards. Logic: Regulatory quality ensures that new material certifications can be effectively processed.", scores: { "Lebanon": 1.0, "UK": 5.0, "KSA": 4.0, "Brazil": 2.0, "Indonesia": 3.0 } }
            ]
        },
        { 
            id: 'c5', 
            name: 'C5: Logistical Practicality', 
            weight: 5, 
            group: 'Feasibility',
            description: 'Infrastructure, road quality, LPI scores, and ease of operations.',
            rationale: "Practicality of fieldwork: Determines the ease of moving samples and conducting on-ground research.",
            indicators: [
                { id: 'i1', name: "LPI Infrastructure Score", contribution: 60, desc: "Uses the Logistics Performance Index to measure infrastructure reliability. Logic: Crucial for the reliable flow of samples and operational research logistics.", scores: { "Lebanon": 1.0, "UK": 5.0, "KSA": 4.0, "Brazil": 3.0, "Indonesia": 2.0 } },
                { id: 'i2', name: "Road Network Quality", contribution: 40, desc: "Assesses the quality of the road network. Logic: Critical for accessing scattered agricultural or industrial residue sites during fieldwork.", scores: { "Lebanon": 1.0, "UK": 5.0, "KSA": 4.0, "Brazil": 3.0, "Indonesia": 2.0 } }
            ]
        },
        { 
            id: 'c6', 
            name: 'C6: Collaboration', 
            weight: 10, 
            group: 'Feasibility',
            description: 'Network strength, access to samples, and academic partnerships.',
            rationale: "Critical enabler: Without access to local labs, partners, and waste streams, material testing cannot proceed.",
            indicators: [
                { id: 'i1', name: "Network Strength", contribution: 53, desc: "Evaluates existing academic and industrial connections. Logic: Strong networks are the core enabler for quickly initiating on-ground research.", scores: { "Lebanon": 5.0, "UK": 5.0, "KSA": 3.0, "Brazil": 2.0, "Indonesia": 2.0 } },
                { id: 'i2', name: "Ease of Access to Samples", contribution: 47, desc: "Reflects bureaucratic, institutional, and operational ease of obtaining samples. Logic: Distinct from theoretical availability; ensures samples can physically be acquired.", scores: { "Lebanon": 4.0, "UK": 5.0, "KSA": 3.0, "Brazil": 3.0, "Indonesia": 3.0 } }
            ]
        },
        { 
            id: 'c7', 
            name: 'C7: Funder Alignment', 
            weight: 20, 
            group: 'Strategic',
            description: 'Alignment with CMA CGM Excellence Fund and strategic focus.',
            rationale: "Ensures alignment with the funding body's goals (CMA CGM Excellence Fund), securing financial and strategic support.",
            indicators: [
                { id: 'i1', name: "CMA CGM Alignment", contribution: 100, desc: "Measures strategic fit with the CMA CGM Excellence Fund. Logic: Binary/decisive factor for the political and financial feasibility of the PhD‚Äôs regional focus.", scores: { "Lebanon": 5.0, "UK": 3.0, "KSA": 3.0, "Brazil": 2.0, "Indonesia": 2.0 } }
            ]
        }
    ];

    const COUNTRIES = ['Lebanon', 'UK', 'KSA', 'Brazil', 'Indonesia'];

    const COLORS = {
        'Lebanon': '#059669',   // brand-primary (Emerald)
        'UK': '#0891b2',        // brand-secondary (Cyan)
        'KSA': '#f59e0b',       // brand-accent (Amber)
        'Brazil': '#8b5cf6',    // Violet
        'Indonesia': '#ec4899'  // Pink
    };

    const App = () => {
        // --- State ---
        const [criteria, setCriteria] = useState(INITIAL_CRITERIA);
        const [activeView, setActiveView] = useState('dashboard'); // 'dashboard', 'indicators', 'methodology'
        const [selectedCountryName, setSelectedCountryName] = useState(null);

        // --- Calculations ---
        const results = useMemo(() => {
            const data = COUNTRIES.map(country => {
                let totalScore = 0;
                const contributions = {};
                const rawScores = {};
                
                // Group Calculations
                let feasibilityWeightedSum = 0;
                let feasibilityTotalWeight = 0;
                let strategicWeightedSum = 0;
                let strategicTotalWeight = 0;
                
                criteria.forEach(crit => {
                    let criterionWeightedSum = 0;
                    let criterionTotalContribution = 0;

                    crit.indicators.forEach(ind => {
                        const score = ind.scores[country];
                        criterionWeightedSum += score * ind.contribution;
                        criterionTotalContribution += ind.contribution;
                    });

                    const criterionScore0to5 = criterionTotalContribution > 0 
                        ? criterionWeightedSum / criterionTotalContribution 
                        : 0;

                    rawScores[crit.id] = criterionScore0to5;

                    const finalVal = criterionScore0to5 * (crit.weight / 100);
                    totalScore += finalVal;
                    contributions[crit.id] = finalVal;

                    // Group Logic
                    if (crit.group === 'Feasibility') {
                        feasibilityWeightedSum += finalVal;
                        feasibilityTotalWeight += crit.weight;
                    } else {
                        strategicWeightedSum += finalVal;
                        strategicTotalWeight += crit.weight;
                    }
                });

                // Normalized Group Scores (0-5)
                const feasibilityScore = feasibilityTotalWeight > 0 ? (feasibilityWeightedSum / (feasibilityTotalWeight/100)) : 0;
                const strategicScore = strategicTotalWeight > 0 ? (strategicWeightedSum / (strategicTotalWeight/100)) : 0;

                return {
                    name: country,
                    score: totalScore.toFixed(2),
                    rawScores: rawScores,
                    contributions,
                    feasibilityScore: feasibilityScore,
                    strategicScore: strategicScore
                };
            });
            return data.sort((a, b) => b.score - a.score);
        }, [criteria]);

        const winner = results[0];
        const runnerUp = results[1];
        const secondRunnerUp = results[2];
        
        // Default selected country to winner if none selected
        const activeCountry = selectedCountryName ? results.find(r => r.name === selectedCountryName) : winner;

        // --- Handlers ---
        const handleWeightChange = (id, newWeight) => {
            setCriteria(prev => prev.map(c => c.id === id ? { ...c, weight: parseFloat(newWeight) } : c));
        };

        const handleIndicatorWeightChange = (critId, indId, newContribution) => {
            setCriteria(prev => prev.map(c => {
                if (c.id !== critId) return c;
                
                const updatedIndicators = c.indicators.map(ind => 
                    ind.id === indId ? { ...ind, contribution: parseFloat(newContribution) } : ind
                );
                return { ...c, indicators: updatedIndicators };
            }));
        };

        const resetData = () => {
            setCriteria(INITIAL_CRITERIA);
        };

        // --- Components ---

        const NavButton = ({ view, label, icon }) => (
            <button 
                onClick={() => setActiveView(view)}
                className={`flex items-center gap-2 px-4 py-2 rounded-full transition whitespace-nowrap text-sm font-semibold border
                    ${activeView === view 
                        ? 'text-brand-primary bg-emerald-50 border-emerald-200 shadow-sm' 
                        : 'text-slate-600 hover:text-brand-primary hover:bg-slate-50 border-transparent'}`}
            >
                <span className="text-base">{icon}</span>
                {label}
            </button>
        );

        return (
            <div className="flex flex-col min-h-screen">
                
                {/* HERO HEADER */}
                <header className="relative bg-gradient-to-br from-emerald-700 via-teal-600 to-cyan-800 text-white pt-16 pb-32 px-6 overflow-hidden shadow-2xl">
                    <div className="absolute inset-0 opacity-10" style={{backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '30px 30px'}}></div>
                    <div className="absolute top-0 right-0 w-96 h-96 bg-emerald-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float"></div>
                    <div className="absolute bottom-0 left-0 w-96 h-96 bg-cyan-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-float" style={{animationDelay: '2s'}}></div>
                    
                    <div className="relative container mx-auto max-w-7xl text-center z-10 animate-fade-in-up">
                        <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-xs font-semibold tracking-wide mb-6 uppercase shadow-sm">
                            <span className="w-2 h-2 bg-emerald-300 rounded-full animate-pulse shadow-[0_0_10px_#34d399]"></span>
                            Decision Matrix
                        </div>
                        
                        <h1 className="text-4xl md:text-6xl font-serif font-bold mb-6 leading-tight drop-shadow-lg tracking-tight">
                            Region Selection MCDA
                        </h1>
                        <p className="text-lg md:text-xl text-emerald-50 font-serif italic max-w-3xl mx-auto mb-10 leading-relaxed font-light">
                            Quantitative decision framework for sustainable materials PhD research location
                        </p>
                        
                        {/* Key Metrics Dashboard (In Header) */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-12 max-w-5xl mx-auto">
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg group">
                                <div className="text-emerald-200 text-xs uppercase tracking-wider font-bold mb-1 group-hover:text-emerald-100">Optimal Region</div>
                                <div className="text-4xl font-serif font-bold text-white">{winner.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {winner.score} / 5.0</div>
                            </div>
                            
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg">
                                <div className="text-cyan-200 text-xs uppercase tracking-wider font-bold mb-1">Runner Up</div>
                                <div className="text-4xl font-serif font-bold text-white">{runnerUp.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {runnerUp.score} / 5.0</div>
                            </div>
                            
                            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-5 border border-white/10 hover:bg-white/20 transition-all duration-300 hover:-translate-y-1 shadow-lg">
                                <div className="text-amber-200 text-xs uppercase tracking-wider font-bold mb-1">2nd Runner Up</div>
                                <div className="text-4xl font-serif font-bold text-white">{secondRunnerUp.name}</div>
                                <div className="text-xs text-white/80 mt-1">Score: {secondRunnerUp.score} / 5.0</div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Curved Bottom Edge */}
                    <div className="absolute bottom-0 left-0 w-full h-16 bg-slate-50 rounded-t-[50%] transform scale-x-150 translate-y-8 shadow-[0_-10px_40px_rgba(0,0,0,0.1)]"></div>
                </header>

                {/* STICKY NAVIGATION */}
                <nav className="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-200/60 shadow-sm supports-[backdrop-filter]:bg-white/60">
                    <div className="container mx-auto max-w-7xl px-4">
                        <div className="flex justify-between items-center py-3">
                            <div className="flex space-x-2 overflow-x-auto scrollbar-hide py-1">
                                <NavButton view="dashboard" label="Dashboard" icon="üìä" />
                                <NavButton view="indicators" label="Indicators" icon="‚ôªÔ∏è" />
                                <NavButton view="methodology" label="Methodology" icon="üî¨" />
                            </div>
                            <div className="hidden sm:block">
                                <a 
                                    href="https://docs.google.com/spreadsheets/d/1t4srfJSubuKvN96GnH5yV0w2yCfk7XVa/export?format=xlsx" 
                                    className="px-4 py-2 text-xs font-semibold bg-brand-primary hover:bg-emerald-700 rounded-full text-white transition shadow-sm flex items-center gap-2"
                                >
                                    <span>üì•</span> Download Data
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>

                <main className="container mx-auto px-4 md:px-6 py-12 max-w-7xl space-y-12">
                    
                    {activeView === 'dashboard' && (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            
                            {/* Sidebar: Sensitivity Analysis */}
                            <aside className="lg:col-span-4 space-y-6">
                                <div className="glass rounded-3xl p-6 shadow-xl sticky top-24 border border-white/50 relative overflow-hidden">
                                    <div className="absolute -top-10 -right-10 w-40 h-40 bg-emerald-100 rounded-full opacity-50 blur-2xl pointer-events-none"></div>

                                    <div className="flex items-center justify-between mb-6 relative z-10">
                                        <h2 className="font-serif font-bold text-slate-800 text-lg flex items-center gap-2">
                                            <span className="text-brand-primary">üéõÔ∏è</span> Sensitivity Controls
                                        </h2>
                                        <button onClick={resetData} className="text-xs font-bold text-brand-secondary hover:text-cyan-700 bg-cyan-50 px-3 py-1 rounded-full transition">Reset</button>
                                    </div>
                                    
                                    <div className="space-y-6 max-h-[65vh] overflow-y-auto pr-2 custom-scrollbar relative z-10">
                                        {criteria.map(c => {
                                            const indSum = c.indicators.reduce((sum, ind) => sum + ind.contribution, 0);
                                            const isSumValid = Math.abs(indSum - 100) < 1;

                                            return (
                                                <div key={c.id} className="bg-white/60 backdrop-blur-sm border border-slate-100 rounded-2xl p-4 shadow-sm hover:shadow-md transition">
                                                    <div className="flex justify-between items-center text-sm mb-3">
                                                        <span className="font-bold text-slate-800 w-2/3 leading-tight">{c.name}</span>
                                                        <span className="font-mono font-bold text-brand-primary bg-emerald-50 px-2 py-1 rounded-lg text-xs">{c.weight}%</span>
                                                    </div>
                                                    <input 
                                                        type="range" 
                                                        min="0" 
                                                        max="50"
                                                        step="1"
                                                        value={c.weight} 
                                                        onChange={(e) => handleWeightChange(c.id, e.target.value)}
                                                        className="w-full mb-4"
                                                    />
                                                    
                                                    <div className="pl-3 border-l-2 border-slate-200 space-y-4">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Indicator Contribution</span>
                                                            <span className={`text-[10px] font-mono font-bold ${isSumValid ? 'text-emerald-600' : 'text-amber-600'}`}>
                                                                Sum: {indSum.toFixed(0)}%
                                                            </span>
                                                        </div>
                                                        {c.indicators.map(ind => (
                                                            <div key={ind.id}>
                                                                <div className="flex justify-between text-[11px] mb-1">
                                                                    <span className="text-slate-600 truncate w-32 font-medium" title={ind.name}>{ind.name}</span>
                                                                    <span className="text-slate-500 font-mono">{ind.contribution}%</span>
                                                                </div>
                                                                <input 
                                                                    type="range" 
                                                                    min="0" 
                                                                    max="100"
                                                                    step="5"
                                                                    value={ind.contribution} 
                                                                    onChange={(e) => handleIndicatorWeightChange(c.id, ind.id, e.target.value)}
                                                                    className="w-full h-1 sub-slider bg-slate-200 rounded-lg appearance-none cursor-pointer"
                                                                />
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    <div className="mt-4 pt-4 border-t border-slate-200 flex justify-between text-sm font-bold text-slate-700 relative z-10">
                                        <span>Total Weight</span>
                                        <span className={criteria.reduce((a,b) => a+b.weight, 0) !== 100 ? "text-red-500" : "text-brand-primary"}>
                                            {criteria.reduce((a,b) => a+b.weight, 0)}%
                                        </span>
                                    </div>
                                </div>
                            </aside>

                            {/* Main Content Area */}
                            <div className="lg:col-span-8 space-y-8">
                                
                                {/* Charts Section 1: Overview */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="font-serif font-bold text-slate-800 text-lg flex items-center gap-2">
                                                <span className="text-brand-secondary">üìà</span> Weighted Scores
                                            </h3>
                                            <span className="text-[10px] text-slate-400 uppercase tracking-wider font-bold">Click bars to filter</span>
                                        </div>
                                        <BarChart data={results} onSelect={(d) => setSelectedCountryName(d.name)} />
                                    </div>
                                    <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover">
                                        <h3 className="font-serif font-bold text-slate-800 text-lg mb-6 flex items-center gap-2">
                                            <span className="text-brand-accent">üï∏Ô∏è</span> Strengths Profile
                                        </h3>
                                        <RadarChart data={results} criteria={criteria} colors={COLORS} />
                                    </div>
                                </div>

                                {/* Charts Section 2: Strategy & Detail */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover">
                                        <h3 className="font-serif font-bold text-slate-800 text-lg mb-2 flex items-center gap-2">
                                            <span className="text-violet-500">üéØ</span> Strategic Matrix
                                        </h3>
                                        <p className="text-xs text-slate-500 mb-6">Technical Feasibility (x) vs. Strategic Value (y)</p>
                                        <BubbleChart data={results} colors={COLORS} />
                                    </div>
                                    <div className="glass p-6 rounded-3xl shadow-lg border border-white/50 card-hover flex flex-col">
                                        <div className="flex justify-between items-center mb-2">
                                            <h3 className="font-serif font-bold text-slate-800 text-lg flex items-center gap-2">
                                                <span className="text-pink-500">üç©</span> Driver Analysis
                                            </h3>
                                            <span className="px-2 py-1 rounded bg-slate-100 text-xs font-bold text-slate-700">{activeCountry.name}</span>
                                        </div>
                                        <p className="text-xs text-slate-500 mb-6">Contribution of each criterion to {activeCountry.name}'s score</p>
                                        <div className="flex-grow flex items-center justify-center">
                                            <DoughnutChart countryData={activeCountry} />
                                        </div>
                                    </div>
                                </div>

                                {/* Decision Matrix */}
                                <div className="bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-100">
                                    <div className="px-8 py-6 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                        <div>
                                            <h3 className="font-serif font-bold text-slate-800 text-lg">Dynamic Decision Matrix</h3>
                                            <p className="text-xs text-slate-500 mt-1">Scores (0-5) derived from weighted indicator averages.</p>
                                        </div>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm text-left">
                                            <thead className="text-xs text-slate-500 uppercase bg-slate-50 border-b border-slate-100">
                                                <tr>
                                                    <th className="px-6 py-4 font-bold tracking-wider">Region</th>
                                                    {criteria.map(c => (
                                                        <th key={c.id} className="px-3 py-4 text-center" title={c.name}>
                                                            <div className="font-bold text-slate-700">{c.id.split(':')[0].toUpperCase()}</div>
                                                            <div className="text-[10px] text-brand-secondary font-mono bg-cyan-50 inline-block px-1 rounded mt-1">{c.weight}%</div>
                                                        </th>
                                                    ))}
                                                    <th className="px-6 py-4 text-right font-bold text-slate-800">Score</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {results.map((res, idx) => (
                                                    <tr key={res.name} 
                                                        onClick={() => setSelectedCountryName(res.name)}
                                                        className={`hover:bg-emerald-50/30 transition-colors cursor-pointer ${selectedCountryName === res.name ? 'bg-emerald-50 border-l-4 border-brand-primary' : ''} ${idx === 0 && !selectedCountryName ? 'bg-emerald-50/20' : ''}`}>
                                                        <td className="px-6 py-4 font-semibold text-slate-800 border-r border-slate-50">
                                                            <div className="flex items-center gap-3">
                                                                <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${idx===0 ? 'bg-brand-primary text-white shadow-md' : 'bg-slate-100 text-slate-500'}`}>{idx + 1}</span>
                                                                {res.name}
                                                            </div>
                                                        </td>
                                                        {criteria.map(c => (
                                                            <td key={c.id} className="px-2 py-4 text-center">
                                                                <span className={`inline-block px-2.5 py-1 rounded-lg text-xs font-bold font-mono ${
                                                                    res.rawScores[c.id] >= 4.0 ? 'bg-emerald-100 text-emerald-800' :
                                                                    res.rawScores[c.id] >= 3.0 ? 'bg-cyan-50 text-cyan-800' :
                                                                    res.rawScores[c.id] <= 2.0 ? 'bg-rose-50 text-rose-800' :
                                                                    'bg-slate-100 text-slate-600'
                                                                }`}>
                                                                    {res.rawScores[c.id].toFixed(1)}
                                                                </span>
                                                            </td>
                                                        ))}
                                                        <td className="px-6 py-4 text-right">
                                                            <span className="text-lg font-bold text-slate-800">{res.score}</span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeView === 'methodology' && (
                        <div className="glass rounded-[2.5rem] p-8 md:p-14 shadow-2xl border border-white/50 relative overflow-hidden">
                             <div className="absolute -top-10 -right-10 w-64 h-64 bg-cyan-100 rounded-full opacity-30 blur-3xl"></div>
                            
                            <h2 className="text-3xl font-serif font-bold text-slate-800 mb-8 flex items-center gap-4 relative z-10">
                                <span className="text-brand-primary bg-emerald-100 p-2 rounded-xl text-2xl">üî¨</span> Methodology & Rationale
                            </h2>
                            
                            <div className="prose max-w-none text-slate-600 relative z-10">
                                <p className="text-lg leading-relaxed mb-10 border-b border-slate-200 pb-8">
                                    The Multi-Criteria Decision Analysis (MCDA) framework objectively selects the optimal region for the PhD research. 
                                    Priorities are driven by <strong className="text-brand-primary">Material Feasibility</strong> (Biomass) and <strong className="text-brand-primary">Strategic Alignment</strong> (Funding).
                                </p>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    {criteria.map((c) => (
                                        <div key={c.id} className="bg-white/60 backdrop-blur-sm border-l-4 border-brand-primary p-6 rounded-r-2xl shadow-sm hover:shadow-md transition card-hover">
                                            <div className="flex justify-between items-start mb-3">
                                                <h3 className="font-bold text-slate-800 text-lg">{c.name}</h3>
                                            </div>
                                            <div className="space-y-4">
                                                <div>
                                                    <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider">Definition</h4>
                                                    <p className="text-sm mt-1">{c.description}</p>
                                                </div>
                                                <div className="bg-slate-50 p-3 rounded-xl border border-slate-100">
                                                    <h4 className="text-xs font-bold text-brand-secondary uppercase tracking-wider mb-1">Rationale</h4>
                                                    <p className="text-sm italic text-slate-600">
                                                        "{c.rationale}"
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeView === 'indicators' && (
                        <div className="space-y-10">
                            <div className="text-center animate-fade-in-up">
                                <span className="text-brand-primary font-bold tracking-widest text-xs uppercase bg-emerald-50 px-3 py-1 rounded-full">Deep Dive</span>
                                <h2 className="text-3xl md:text-4xl font-serif font-bold text-slate-900 mt-4 flex items-center justify-center gap-3">
                                    <span className="text-3xl">‚ôªÔ∏è</span> Criteria Indicators
                                </h2>
                                <p className="text-slate-500 mt-3 max-w-2xl mx-auto">Detailed breakdown of the specific indicators and logic used to evaluate each criterion.</p>
                            </div>

                            <div className="grid gap-8">
                                {criteria.map((c) => (
                                    <div key={c.id} className="bg-white rounded-[2rem] shadow-md border border-slate-100 overflow-hidden card-hover">
                                        <div className="bg-slate-50/80 px-8 py-5 border-b border-slate-100 flex justify-between items-center backdrop-blur-sm">
                                            <h3 className="font-bold text-slate-800 text-lg flex items-center gap-2">
                                                <span className="w-2 h-8 rounded-full bg-brand-primary"></span>
                                                {c.name}
                                            </h3>
                                            <span className="text-xs font-mono text-slate-400 font-bold uppercase tracking-wider hidden sm:inline-block">
                                                Total Contrib: {c.indicators.reduce((sum, i) => sum + i.contribution, 0)}%
                                            </span>
                                        </div>
                                        <div className="p-0">
                                            <table className="w-full text-sm text-left">
                                                <tbody className="divide-y divide-slate-50">
                                                    {c.indicators.map((ind, idx) => (
                                                        <tr key={idx} className="hover:bg-slate-50/80 transition">
                                                            <td className="px-8 py-5 w-1/3 align-top">
                                                                <div className="font-bold text-slate-700 text-base">{ind.name}</div>
                                                            </td>
                                                            <td className="px-6 py-5 w-1/6 text-center align-top">
                                                                <span className="inline-block bg-emerald-50 text-brand-primary text-xs font-bold px-3 py-1 rounded-full border border-emerald-100">
                                                                    {ind.contribution}%
                                                                </span>
                                                            </td>
                                                            <td className="px-8 py-5 text-slate-600 leading-relaxed text-sm align-top">
                                                                {ind.desc}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                </main>

                {/* FOOTER */}
                <footer className="bg-slate-900 text-slate-400 py-16 border-t border-slate-800 mt-auto">
                    <div className="container mx-auto max-w-6xl text-center px-4">
                        <div className="mb-8">
                            <span className="text-2xl font-serif text-slate-200 font-bold tracking-tight">PhD Research Dashboard</span>
                        </div>
                        <div className="grid md:grid-cols-3 gap-8 max-w-3xl mx-auto mb-10 text-sm">
                            <div><h4 className="text-slate-300 font-bold mb-2">Phase</h4><p>Region Selection MCDA</p></div>
                            <div><h4 className="text-slate-300 font-bold mb-2">Focus</h4><p>Bio-based Construction Materials</p></div>
                            <div><h4 className="text-slate-300 font-bold mb-2">Candidate</h4><p>Mika - University of Bath</p></div>
                        </div>
                    </div>
                </footer>
            </div>
        );
    };

    // --- Chart Components ---

    const BarChart = ({ data, onSelect }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();

            const ctx = canvasRef.current.getContext('2d');
            
            const datasets = Object.keys(data[0].contributions).map((critId, i) => {
                const palette = ['#059669', '#0891b2', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1', '#ef4444'];
                return {
                    label: critId.split(':')[0].toUpperCase(),
                    data: data.map(d => d.contributions[critId]),
                    backgroundColor: palette[i % palette.length],
                    barThickness: 24,
                    borderRadius: 4,
                };
            });

            chartRef.current = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.name),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            onSelect(data[index]);
                        }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { usePointStyle: true, boxWidth: 8, padding: 20, font: {family: "'Inter', sans-serif", size: 11} } },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            padding: 12,
                            titleFont: {family: "'Lora', serif", size: 13},
                            bodyFont: {family: "'Inter', sans-serif", size: 12},
                            callbacks: {
                                footer: (items) => 'Total: ' + items.reduce((a, b) => a + b.raw, 0).toFixed(2)
                            }
                        }
                    },
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, beginAtZero: true, max: 5, grid: { color: '#f1f5f9', borderDash: [4, 4] }, border: {display: false} }
                    }
                }
            });

            return () => {
                if (chartRef.current) chartRef.current.destroy();
            }
        }, [data]);

        return <div className="relative h-80 w-full cursor-pointer"><canvas ref={canvasRef} /></div>;
    };

    const RadarChart = ({ data, criteria, colors }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();
            const ctx = canvasRef.current.getContext('2d');
            
            const datasets = data.map(d => ({
                label: d.name,
                data: criteria.map(c => d.rawScores[c.id]),
                backgroundColor: colors[d.name] + '20', 
                borderColor: colors[d.name],
                borderWidth: 2,
                pointBackgroundColor: colors[d.name],
                pointRadius: 3,
                pointHoverRadius: 5
            }));

            chartRef.current = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: criteria.map(c => c.id.split(':')[0].toUpperCase()),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#e2e8f0' },
                            pointLabels: { font: {family: "'Inter', sans-serif", size: 10, weight: '600'}, color: '#64748b' },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: { display: false }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8, padding: 20, font: {family: "'Inter', sans-serif", size: 11} } },
                        tooltip: { backgroundColor: 'rgba(15, 23, 42, 0.9)', padding: 12 }
                    }
                }
            });

            return () => { if (chartRef.current) chartRef.current.destroy(); }
        }, [data, criteria, colors]);

        return <div className="relative h-80 w-full"><canvas ref={canvasRef} /></div>;
    };

    const BubbleChart = ({ data, colors }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();
            const ctx = canvasRef.current.getContext('2d');

            const datasets = data.map(d => ({
                label: d.name,
                data: [{ x: d.feasibilityScore, y: d.strategicScore, r: parseFloat(d.score) * 4 }],
                backgroundColor: colors[d.name] + '80',
                borderColor: colors[d.name],
            }));

            chartRef.current = new Chart(ctx, {
                type: 'bubble',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: 'Feasibility Score (Technical + Logistics)' },
                            min: 0, max: 5.5, grid: { color: '#e2e8f0' }
                        },
                        y: { 
                            title: { display: true, text: 'Strategic Value (Market + Funding)' },
                            min: 0, max: 5.5, grid: { color: '#e2e8f0' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.dataset.label}: Feas ${ctx.raw.x.toFixed(1)}, Strat ${ctx.raw.y.toFixed(1)}`
                            }
                        }
                    }
                }
            });
            return () => { if (chartRef.current) chartRef.current.destroy(); }
        }, [data, colors]);

        return <div className="relative h-80 w-full"><canvas ref={canvasRef} /></div>;
    };

    const DoughnutChart = ({ countryData }) => {
        const chartRef = useRef(null);
        const canvasRef = useRef(null);

        useEffect(() => {
            if (chartRef.current) chartRef.current.destroy();
            if (!countryData) return;

            const ctx = canvasRef.current.getContext('2d');
            const labels = Object.keys(countryData.contributions).map(k => k.split(':')[0].toUpperCase());
            const values = Object.values(countryData.contributions);
            const palette = ['#059669', '#0891b2', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1', '#ef4444'];

            chartRef.current = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: palette,
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'right', labels: { boxWidth: 10, font: { size: 10 } } },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.label}: ${ctx.raw.toFixed(2)} pts`
                            }
                        }
                    }
                }
            });
            return () => { if (chartRef.current) chartRef.current.destroy(); }
        }, [countryData]);

        return <div className="relative h-64 w-full"><canvas ref={canvasRef} /></div>;
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>
